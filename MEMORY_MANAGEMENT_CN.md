# Rive Android å†…å­˜ç®¡ç†æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

Rive ä½¿ç”¨ C++ å®ç°æ ¸å¿ƒé€»è¾‘ï¼Œä»¥ä¾¿åœ¨ä¸åŒå¹³å°çš„è¿è¡Œæ—¶ä¹‹é—´å…±äº«ä»£ç ï¼ŒåŒæ—¶ä¿è¯å„å¹³å°ä¹‹é—´çš„é«˜åº¦ä¸€è‡´æ€§ã€‚å¤§éƒ¨åˆ†è¿è¡Œæ—¶é€»è¾‘éƒ½åœ¨ C++ å±‚å®ç°ï¼Œè€Œå„åŸç”Ÿè¿è¡Œæ—¶åªæ˜¯å¯¹å…³é”®è°ƒç”¨è¿›è¡Œå°è£…ã€‚

å¯¹äºåº“çš„ä½¿ç”¨è€…æ¥è¯´ï¼Œå¤§éƒ¨åˆ†äº¤äº’éƒ½æ˜¯é€æ˜çš„ï¼Œä½†éšç€ä½¿ç”¨çš„æ·±å…¥ï¼Œæœ‰ä¸€äº›å…³é”®ç‚¹éœ€è¦äº†è§£ã€‚

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### Native å¯¹è±¡

è®¸å¤š Rive ç±»éƒ½å­˜å‚¨äº†å¯¹å…¶ C++ ä¼´ç”Ÿå¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

| ç±»å | è¯´æ˜ |
|------|------|
| `File` | Rive æ–‡ä»¶å¯¹è±¡ |
| `Artboard` | ç”»æ¿å¯¹è±¡ |
| `LinearAnimationInstance` | çº¿æ€§åŠ¨ç”»å®ä¾‹ |
| `StateMachineInstance` | çŠ¶æ€æœºå®ä¾‹ |
| `SMIInput` | çŠ¶æ€æœºè¾“å…¥ï¼ˆBoolean/Number/Triggerï¼‰|

å½“æˆ‘ä»¬è°ƒç”¨è¿™äº›ç±»çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ JNI å°†è°ƒç”¨ä¼ é€’ç»™ C++ å¯¹è±¡ã€‚

### åƒåœ¾å›æ”¶

å¤§å¤šæ•°åœ¨ C++ ä¸­åˆ›å»ºçš„å¯¹è±¡ä¹Ÿä¼šåœ¨ C++ ä¸­è¢«åƒåœ¾å›æ”¶ï¼Œ**ä½†ä»¥ä¸‹å¯¹è±¡é™¤å¤–**ï¼š

- `File`
- `Artboard`
- `LinearAnimationInstance`
- `StateMachineInstance`

âš ï¸ **é‡è¦**ï¼šè¿™äº›å¯¹è±¡éœ€è¦æ‰‹åŠ¨è°ƒç”¨ `release()` è¿›è¡Œæ¸…ç†ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼

---

## ğŸ“± RiveAnimationView çš„è‡ªåŠ¨ç®¡ç†

### ç”Ÿå‘½å‘¨æœŸç®¡ç†

`RiveAnimationView` ä¸ºç”¨æˆ·æŠ½è±¡äº†å¤§éƒ¨åˆ†å†…å­˜ç®¡ç†å·¥ä½œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RiveAnimationView                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  onAttachedToWindow()  â†’  åˆ†é… Native å¯¹è±¡                    â”‚
â”‚  onDetachedFromWindow() â†’  é‡Šæ”¾ Native å¯¹è±¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å½“ View ä»çª—å£åˆ†ç¦»æ—¶ï¼Œ`RiveAnimationView` ä¼šè‡ªåŠ¨åˆ é™¤ï¼š
- âœ… å¯¹åº”çš„ Rive `File` å¯¹è±¡
- âœ… ä»è¯¥ `File` æ´¾ç”Ÿçš„æ‰€æœ‰ç±»ï¼ˆå¦‚ `Artboard`ã€`StateMachineInstance`ï¼‰

### ä½¿ç”¨æ³¨æ„äº‹é¡¹

| æƒ…å†µ | è¯´æ˜ |
|------|------|
| âœ… **æ­£å¸¸ä½¿ç”¨** | ç”¨æˆ·ä¸éœ€è¦æ˜¾å¼åˆ é™¤ C++ å¯¹è±¡ |
| âš ï¸ **å¼‚å¸¸æƒ…å†µ** | å°è¯•è®¿é—®å·²åˆ é™¤å¯¹è±¡çš„ C++ å±æ€§æ—¶ï¼Œä¼šæŠ›å‡º `RiveException` |
| âŒ **åº”é¿å…** | åœ¨ View ç”Ÿå‘½å‘¨æœŸå¤–ï¼ˆ`onDetachedFromWindow()` ä¹‹åï¼‰ä½¿ç”¨ Native å¯¹è±¡ |

---

## ğŸ—ï¸ ç±»å±‚æ¬¡ç»“æ„

### RiveAnimationView ç»§æ‰¿å…³ç³»

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      RiveAnimationView          â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚ override                        â”‚
         â”‚ renderer: RiveArtboardRenderer  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                       ç»§æ‰¿
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   RiveTextureView    â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ abstract             â”‚
              â”‚ renderer: Renderer   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                              â”‚
         ç»§æ‰¿                           å®ç°
           â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    TextureView     â”‚    â”‚   SurfaceTextureListener      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ onAttachedToWindow â”‚    â”‚ onSurfaceTextureAvailable     â”‚
â”‚ onDetachedFromWindowâ”‚   â”‚ onSurfaceTextureDestroyed     â”‚
â”‚ onVisibilityChangedâ”‚    â”‚ onSurfaceTextureUpdated       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ onSurfaceTextureSizeChanged   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— NativeObjectã€ç»§æ‰¿ä¸ä¾èµ–å…³ç³»

### ä¾èµ–å…³ç³»è§„åˆ™

| å…³ç³»ç±»å‹ | è¯´æ˜ |
|---------|------|
| `has` (æ‹¥æœ‰) | è¢«åˆ›å»ºçš„å¯¹è±¡ç”±å…¶åˆ›å»ºè€…"æ‹¥æœ‰" |
| `is-a` (ç»§æ‰¿) | è¡¨ç¤ºç±»ç»§æ‰¿å…³ç³» |

### å¼•ç”¨è®¡æ•°æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é‡Šæ”¾æµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Native å¯¹è±¡è°ƒç”¨ release()                                    â”‚
â”‚         â†“                                                       â”‚
â”‚  2. é¦–å…ˆé‡Šæ”¾å…¶æ‰€æœ‰ä¾èµ–å¯¹è±¡ (dependencies)                         â”‚
â”‚         â†“                                                       â”‚
â”‚  3. ç„¶åå‡å°‘è‡ªå·±çš„å¼•ç”¨è®¡æ•°                                        â”‚
â”‚         â†“                                                       â”‚
â”‚  4. å¦‚æœè®¡æ•°è¾¾åˆ° 0ï¼Œåˆ™è°ƒç”¨ JNI ææ„å‡½æ•°                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¤ºä¾‹ï¼šFile åˆ›å»º Artboard

```kotlin
// å½“ File å®ä¾‹åŒ–ä¸€ä¸ª Artboard æ—¶ï¼š
val artboard = file.artboard("MyArtboard")
// â†’ artboard è¢«æ·»åŠ åˆ° file.dependencies ä¸­
// â†’ artboard ç”± file "æ‹¥æœ‰"

// å½“ file.release() è¢«è°ƒç”¨æ—¶ï¼š
// â†’ ä¼šçº§è”è°ƒç”¨ artboard.release()
// â†’ ç„¶åå†é‡Šæ”¾ file è‡ªèº«
```

### å†…éƒ¨ä¾èµ–å±‚æ¬¡å›¾

```
                                         dependencies: List<NativeObject>
                                                         â”‚
                                                        æ‹¥æœ‰
                                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚RiveArtboardRendererâ”œâ”€ç»§æ‰¿â”€â†’â”‚  Renderer  â”œâ”€ç»§æ‰¿â”€â†’â”‚NativeObjectâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜
          â”‚                                              â”‚
         æ‹¥æœ‰                                            â”‚
          â”‚                                              â”‚
        â”Œâ”€â”´â”€â”€â”                                           â”‚
        â”‚Fileâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç»§æ‰¿â”¤
        â””â”€â”¬â”€â”€â”˜                                           â”‚
          â”‚                                              â”‚
         æ‹¥æœ‰                                            â”‚
          â”‚                                              â”‚
      â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”                                         â”‚
      â”‚Artboardâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç»§æ‰¿â”¤
      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
          â”‚                                              â”‚
         æ‹¥æœ‰                                            â”‚
          â”‚                                              â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
          â”œâ”€â”¤LinearAnimationInstanceâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç»§æ‰¿â”¤
          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
          â”‚                                              â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
          â””â”€â”¤StateMachineInstanceâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç»§æ‰¿â”¤
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                      â”‚                                  â”‚
                     æ‹¥æœ‰                                â”‚
                      â”‚                                  â”‚
                 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                            â”‚
                 â”‚SMIInput  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç»§æ‰¿â”˜
                 â”‚LayerStateâ”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ å¸¸è§é”™è¯¯ä¸æ­£ç¡®åšæ³•

### âŒ é”™è¯¯ï¼šæ‰‹åŠ¨é‡Šæ”¾ç”± SDK ç®¡ç†çš„å¯¹è±¡

```kotlin
// âŒ é”™è¯¯åšæ³•
fun printInfo(riveView: RiveAnimationView) {
    val file = riveView.controller.file!!
    val artboard = file.artboard("MyArtboard")  // åˆ›å»ºæ–°å®ä¾‹
    
    // ... ä½¿ç”¨ artboard ...
    
    artboard.release()  // âŒ é”™è¯¯ï¼è¿™ä¼šç ´åå¼•ç”¨è®¡æ•°ï¼
}
```

**é—®é¢˜**ï¼š
1. `file.artboard()` åˆ›å»ºçš„ artboard ä¼šè‡ªåŠ¨æ·»åŠ åˆ° `file.dependencies`
2. æ‰‹åŠ¨è°ƒç”¨ `release()` ä¼šå°† refs é™ä¸º 0
3. ä½† artboard ä»åœ¨ `file.dependencies` ä¸­
4. å½“ file è¢«é‡Šæ”¾æ—¶ï¼Œä¼šå†æ¬¡å°è¯•é‡Šæ”¾è¿™ä¸ªå·²ç» refs=0 çš„å¯¹è±¡
5. ğŸ’¥ å¯¼è‡´ `Failed requirement` é”™è¯¯ï¼

### âœ… æ­£ç¡®ï¼šè®© SDK ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

```kotlin
// âœ… æ­£ç¡®åšæ³• 1ï¼šä½¿ç”¨ controller å·²æœ‰çš„å¯¹è±¡
fun printInfo(riveView: RiveAnimationView) {
    // ä½¿ç”¨ activeArtboardï¼ˆç”± controller ç®¡ç†ï¼‰
    val artboard = riveView.controller.activeArtboard
    Log.d("Info", "Artboard: ${artboard?.name}")
    
    // ä½¿ç”¨ stateMachinesï¼ˆç”± controller ç®¡ç†ï¼‰
    riveView.stateMachines.forEach { sm ->
        Log.d("Info", "SM: ${sm.name}")
    }
    
    // âœ… ä¸éœ€è¦è°ƒç”¨ release()ï¼
}

// âœ… æ­£ç¡®åšæ³• 2ï¼šå¦‚æœå¿…é¡»åˆ›å»ºæ–°å®ä¾‹ï¼Œä¸è¦æ‰‹åŠ¨é‡Šæ”¾
fun createArtboard(file: File): Artboard {
    val artboard = file.artboard("MyArtboard")
    // artboard ä¼šè¢«æ·»åŠ åˆ° file.dependencies
    // å½“ file è¢«é‡Šæ”¾æ—¶ï¼Œartboard ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾
    return artboard
    // âœ… ä¸è¦è°ƒç”¨ artboard.release()ï¼
}
```

### âœ… æ­£ç¡®ï¼šè‡ªå·±åˆ›å»ºçš„ File éœ€è¦æ‰‹åŠ¨é‡Šæ”¾

```kotlin
// âœ… è‡ªå·±åˆ›å»ºçš„ File éœ€è¦è´Ÿè´£é‡Šæ”¾
fun loadCustomFile(bytes: ByteArray): File {
    val file = File(bytes, RendererType.Rive)
    
    // ä½¿ç”¨ file...
    
    // âœ… éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼ˆå› ä¸ºæ˜¯è‡ªå·±åˆ›å»ºçš„ï¼‰
    file.release()
}

// âœ… æˆ–è€…æ·»åŠ åˆ° Renderer çš„ dependencies ä¸­
fun loadCustomFileWithRenderer(bytes: ByteArray, renderer: Renderer) {
    val file = File(bytes, RendererType.Rive)
    renderer.dependencies.add(file)
    file.acquire()  // å¢åŠ å¼•ç”¨è®¡æ•°
    
    // âœ… file ä¼šåœ¨ renderer.delete() æ—¶è‡ªåŠ¨é‡Šæ”¾
}
```

---

## ğŸ› ï¸ è‡ªå®šä¹‰æ¸²æŸ“å¾ªç¯

å¦‚æœéœ€è¦å®ç°è‡ªå®šä¹‰æ¸²æŸ“å¾ªç¯ï¼Œå¯ä»¥å‚è€ƒ [`LowLevelActivity`](./app/src/main/java/app/rive/runtime/example/LowLevelActivity.kt) ç¤ºä¾‹ã€‚

å…³é”®ç‚¹ï¼šå°† `File` æ·»åŠ åˆ° `Renderer` çš„ `dependencies` ä¸­ï¼Œè¿™æ ·ä¼šåœ¨æ­£ç¡®çš„æ—¶æœºï¼ˆ`onDetachedFromWindow` å†…ï¼‰è¿›è¡Œæ¸…ç†ã€‚

```kotlin
class CustomRenderer : Renderer() {
    fun loadFile(bytes: ByteArray) {
        val file = File(bytes, RendererType.Rive)
        // æ·»åŠ åˆ°ä¾èµ–ä¸­ï¼Œå®ç°è‡ªåŠ¨æ¸…ç†
        dependencies.add(file)
        file.acquire()
    }
}
```

---

## ğŸ“š API é€ŸæŸ¥è¡¨

### å¼•ç”¨è®¡æ•° API

| æ–¹æ³• | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `acquire()` | å¢åŠ å¼•ç”¨è®¡æ•° | å½“éœ€è¦ä¿æŒå¯¹è±¡å­˜æ´»æ—¶ |
| `release()` | å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä¸º 0 æ—¶è§¦å‘ dispose | å½“ä¸å†éœ€è¦å¯¹è±¡æ—¶ |
| `refs` | å½“å‰å¼•ç”¨è®¡æ•° | è°ƒè¯•ç”¨ |
| `hasCppObject` | æ˜¯å¦æœ‰æœ‰æ•ˆçš„ C++ æŒ‡é’ˆ | æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²é‡Šæ”¾ |

### RiveAnimationView ç”Ÿå‘½å‘¨æœŸ

| äº‹ä»¶ | è‡ªåŠ¨è¡Œä¸º |
|------|----------|
| `onAttachedToWindow()` | åˆ›å»º Rendererï¼ŒåŠ è½½ File |
| `onDetachedFromWindow()` | è°ƒç”¨ `renderer.delete()`ï¼Œé‡Šæ”¾æ‰€æœ‰èµ„æº |
| Activity `onDestroy()` | `RiveViewLifecycleObserver` é‡Šæ”¾ dependencies |

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æµ‹å†…å­˜æ³„æ¼

```kotlin
// ä½¿ç”¨ LeakCanary æ£€æµ‹
// build.gradle:
// debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.x'

// æˆ–ä½¿ç”¨ Android Profiler æŸ¥çœ‹å†…å­˜ä½¿ç”¨
```

### å¸¸è§é”™è¯¯æ—¥å¿—

```
// å¼•ç”¨è®¡æ•°é—®é¢˜
RiveException: Accessing disposed C++ object Artboard.

// JNI é”™è¯¯ï¼ˆä¸¥é‡ï¼‰
JNI DETECTED ERROR IN APPLICATION: 
    java.lang.IllegalArgumentException: Failed requirement.

// è§£å†³æ–¹æ³•ï¼šæ£€æŸ¥æ˜¯å¦æ‰‹åŠ¨è°ƒç”¨äº† release()ï¼Œåˆ é™¤é‚£äº›è°ƒç”¨ï¼
```

---

## ğŸ“– å†å²è¯´æ˜

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ `finalize()`ï¼Ÿ

åœ¨ rive-android 4.0 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¾èµ– Kotlin çš„ `finalize()` è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ç†è®ºä¸Šï¼Œ`finalize()` åº”è¯¥èƒ½å¸®åŠ©æˆ‘ä»¬é¿å…ä¸€äº›æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„å¤æ‚æ€§ã€‚

**ä½†å®é™…é—®é¢˜**ï¼š
- åœ¨è¾ƒæ—§çš„ Android è®¾å¤‡ä¸Šå¶å°”ä¼šäº§ç”Ÿé”™è¯¯
- é‡åˆ°ç±»ä¼¼ [è¿™ä¸ªé—®é¢˜](https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin) çš„æƒ…å†µ
- `finalize()` å·²è¢«å®˜æ–¹åºŸå¼ƒ

å› æ­¤ï¼Œæˆ‘ä»¬æ”¹ç”¨äº†åŸºäºå¼•ç”¨è®¡æ•°çš„æ˜¾å¼å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚

---

## ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“

| åœºæ™¯ | æ¨èåšæ³• |
|------|----------|
| ä½¿ç”¨ RiveAnimationView | æ— éœ€æ‰‹åŠ¨ç®¡ç†ï¼Œè®© SDK è‡ªåŠ¨å¤„ç† |
| è·å– Artboard ä¿¡æ¯ | ä½¿ç”¨ `controller.activeArtboard`ï¼Œä¸è¦åˆ›å»ºæ–°å®ä¾‹ |
| è·å– StateMachine ä¿¡æ¯ | ä½¿ç”¨ `riveView.stateMachines`ï¼Œä¸è¦æ‰‹åŠ¨é‡Šæ”¾ |
| è‡ªå®šä¹‰æ¸²æŸ“å¾ªç¯ | å°† File æ·»åŠ åˆ° Renderer.dependencies |
| è‡ªå·±åˆ›å»º File | éœ€è¦æ‰‹åŠ¨è°ƒç”¨ `release()` |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šåŸºäº MEMORY_MANAGEMENT.md ç¿»è¯‘  
**æœ€åæ›´æ–°**ï¼š2024-12-16

